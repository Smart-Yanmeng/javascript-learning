<!DOCTYPE html>
<html>
<head>
    <title>Render the Earth</title>
<!--    <link rel="stylesheet" href="./css/earth.css">-->
<!--    <link rel="stylesheet" href="./css/d3tip.css">-->
    <script src="./../lib/d3.v7.min.js"></script>
    <script src="./../lib/topojson.js"></script>
    <script src="./../lib/d3-tip.js"></script>
</head>
<body>
<svg width="1600" height="800" id="mainsvg" class="svgs"></svg>
<script>

    let svg = d3.select('svg');
    const width = +svg.attr('width');
    const height = +svg.attr('height');
    const margin = {top: 60, right: 60, bottom: 10, left: 60};
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;
    const g = svg.append('g').attr('id', 'maingroup')
        .attr('transform', `translate(${margin.left}, ${margin.top})`);

    const projection = d3.geoNaturalEarth1();
    const pathGenerator = d3.geoPath().projection(projection);

    let worldmeta;

    // setting up the tip tool;
    const tip = d3.tip()
        .attr('class', 'd3-tip').html(d => d.properties.name);
    svg.call(tip);

    d3.json('./countries-110m.json').then(
        function (data) {
            // convert topo-json to geo-json;
            worldmeta = topojson.feature(data, data.objects.countries);

            console.log(worldmeta.features.map(d => d.properties.name))

            // this code is really important if you want to fit your geoPaths (map) in your SVG element;
            projection.fitSize([innerWidth, innerHeight], worldmeta);

            // perform data-join;
            g.selectAll('path')
                .data(worldmeta.features)
                .join('path')
                .attr('d', pathGenerator)
                .attr('stroke', 'black')
                .attr('stroke-width', 1)
                .on('mouseover', function (d) {
                    d3.select(this)
                        .attr('opacity', 0.5)
                        .attr('stroke', 'white');
                })
                .on('mouseout', function (d) {
                    d3.select(this)
                        .attr('opacity', 1)
                        .attr('stroke', 'black');
                })
                .on('click', function (d) {
                    console.log(d);
                    // tip.show(d);
                })
        }
    );

</script>
</body>
</html>